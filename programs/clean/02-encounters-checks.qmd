---
author: Sarah Cohen
date: last-modified
title: Arrest table cleanup
subtitle: ""
format:
  scdefault-html:
    code-fold: show
    toc: false
execute:
  echo: fenced
  warning: true
  message: true
  error: true
  cache: false
  eval: true

engine: knitr
---


/Users/sarah/Github/deportation-data/data/raw/ddp/2025-ICLI-00019_2024-ICFO-39357_ERO_Encounters_07312025.xlsx

```{r}
#| label: setup
#| message: false
#| echo: fenced
#| error: true
#| code-fold: true

# assumes pacman has been installed already



#start with a blank slate

rm (list=ls())

# typical packages
pacman::p_load("tidyverse", "glue", "lubridate", "janitor", "readxl", "here", "googlesheets4")
here::i_am("programs/clean/02-encounters-checks.qmd")


#additional packages here
library(data.table)
# don't use openxlsx -- it doesn't really support the named regions that include tables.
library(openxlsx2)

# when was this last picked up from the Deportation Data Project?
orig_xl_date <- mdy("10/14/2025")
xl_filename <- "data/raw/ddp/2025-ICLI-00019_2024-ICFO-39357_ERO_Encounters_07312025.xlsx"




```

The encounters is supposed to log each encounter with a person that ICE suspects, but it's unclear how complete it is. An encounter could mean a lot of things -- the most frequent is a fingerprint match with a local jail. But it can also mean street encounters. It's important to remember that an encounter might not be of someone who tells the truth or someone who is known to ICE.

```{r}
#| label: get-workbook-only
#| eval: false

# this is slow. But loading the full workbook to get the ranges is also slow. I could
# skip this because i know you skip 6 rows, but ...
wb <- wb_load(here(xl_filename))

```


The `openxlsx2` library has a much better way to get the named regions: you can tell it to include the tables, which returns a data frame that you can filter for only tables types.



```{r}
#| label: get-xl-data-frames
#| code-fold: true

table_ranges <- wb_get_named_regions( wb, tables=TRUE)  |>
  filter ( value == "table") |>
  pull ( name)

dfs <- map ( table_ranges, \(x) wb_to_df (wb, named_region = x))

full_df <- dfs |>
  list_rbind() |>
  clean_names() |>
  select ( - c( final_program_group, birth_date, alien_file_number:eid_subject_id)) |>
  # sadly, there is no time element in the event_date or departed_date.
  mutate ( across ( c (event_date, final_order_date), as_date))

glimpse(full_df)
```

A quick review of this file suggests that it's of less use on its own than as part of a continuum. It would be interesting from a national perspective , but less so from local.

What it would have that the others don't is people who were NOT detained and were NOT arrested and were NOT removed, but it's unclear how we'd get to that

There are still no US citizens purportedly in this data. The ones that I've found online were people detained not in ICE facilities (or arrested by ICE for immigration violations) but people arrested and put into federal law enforcement faciltities. Still, it's useful to see how they come across. Here are a few cases that I might want to look up across datasets:

* 6/24/25

2025-06-23
